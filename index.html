<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Танк и монетки</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #222; touch-action: manipulation; }
        canvas { display: block; background: #228B22; }
        #controls {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }
        .row { display: flex; }
        .btn {
            width: 60px; height: 60px;
            margin: 5px; font-size: 28px;
            text-align: center; line-height: 60px;
            border: 2px solid black; background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            user-select: none; cursor: pointer;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="controls">
    <div class="btn" id="btn-up">↑</div>
    <div class="row">
        <div class="btn" id="btn-left">←</div>
        <div style="width: 60px;"></div>
        <div class="btn" id="btn-right">→</div>
    </div>
    <div class="btn" id="btn-down">↓</div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let tank = { x: 0, y: 0, size: 40, speed: 22.5, dir: 'up' };
    let coins = generateCoins(10);
    let movement = { up: false, down: false, left: false, right: false };

    function generateCoins(count) {
        let arr = [];
        for (let i = 0; i < count; i++) {
            arr.push({ x: (Math.random() * 2000) - 1000, y: (Math.random() * 2000) - 1000, size: 15 });
        }
        return arr;
    }

    function drawTank() {
        ctx.fillStyle = "black";
        let { x, y, size, dir } = tank;
        let cx = canvas.width / 2, cy = canvas.height / 2;

        ctx.save();
        ctx.translate(cx, cy);
        if (dir === 'right') ctx.rotate(Math.PI / 2);
        if (dir === 'down') ctx.rotate(Math.PI);
        if (dir === 'left') ctx.rotate(-Math.PI / 2);
        
        ctx.fillRect(-size / 2, -size / 2, size, size);
        ctx.fillRect(-10, -30, 20, 20);
        ctx.restore();
    }

    function drawCoins() {
        ctx.fillStyle = "yellow";
        coins.forEach(coin => {
            ctx.beginPath();
            ctx.arc(canvas.width / 2 + coin.x - tank.x, canvas.height / 2 + coin.y - tank.y, coin.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = "black";
            ctx.stroke();
        });
    }

    function checkCollisions() {
        coins = coins.filter(coin => {
            let dist = Math.hypot(coin.x - tank.x, coin.y - tank.y);
            if (dist < tank.size / 2 + coin.size) {
                // Генерируем новую монету в радиусе 100px от танка
                coins.push({
                    x: tank.x + (Math.random() * 200 - 100),
                    y: tank.y + (Math.random() * 200 - 100),
                    size: 15
                });
                return false;
            }
            return true;
        });
    }

    function moveTank() {
        if (movement.up) {
            tank.dir = 'up';
            tank.y -= tank.speed;
        }
        if (movement.down) {
            tank.dir = 'down';
            tank.y += tank.speed;
        }
        if (movement.left) {
            tank.dir = 'left';
            tank.x -= tank.speed;
        }
        if (movement.right) {
            tank.dir = 'right';
            tank.x += tank.speed;
        }
    }

    function update() {
        moveTank();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawCoins();
        drawTank();
        checkCollisions();
        requestAnimationFrame(update);
    }function setMove(direction, state) {
        movement[direction] = state;
    }

    document.getElementById("btn-up").addEventListener("touchstart", () => setMove('up', true));
    document.getElementById("btn-down").addEventListener("touchstart", () => setMove('down', true));
    document.getElementById("btn-left").addEventListener("touchstart", () => setMove('left', true));
    document.getElementById("btn-right").addEventListener("touchstart", () => setMove('right', true));

    document.getElementById("btn-up").addEventListener("touchend", () => setMove('up', false));
    document.getElementById("btn-down").addEventListener("touchend", () => setMove('down', false));
    document.getElementById("btn-left").addEventListener("touchend", () => setMove('left', false));
    document.getElementById("btn-right").addEventListener("touchend", () => setMove('right', false));

    Telegram.WebApp.ready();
    update();
</script>
</body>
</html>